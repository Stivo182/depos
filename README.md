# depos

**depos** - это инструмент для обновления зависимостей пакетов OneScript до актуальных версий в файле `packagedef`.

- Модифицируется _только_ файл `packagedef`. Для обновления пакетов надо запустить `opm install`.
- Обновление до _последней_, _минорной_ или _патч_-версии.
- Фильтрация пакетов по имени, шаблону или регулярному выражению.
- Диагностика зависимостей и поиск проблем.

## Использование

### Проверка обновлений зависимостей

Команда `check` проверяет наличие обновлений для зависимостей в файле `packagedef` без внесения изменений.

```bash
depos check
```

**Пример вывода:**
```bash
Проверка зависимостей: path/to/packagedef

 ↑ 1connector         2.3.1 → 2.3.3
 ↑ autumn             3.3.0 → 4.3.11
 ↑ autumn-cli         1.1.0 → 1.2.0
   semver             1.0.0 → 1.0.0

Найдено обновлений: 3
```

### Обновление зависимостей

Команда `upgrade` обновляет версии зависимостей в файле `packagedef` до указанных целевых версий.

> [!CAUTION]
> Убедитесь, что файл `packagedef` находится в системе контроля версий, и все изменения зафиксированы. Это действие перезапишет ваш файл.

```bash
depos upgrade
```

**Пример вывода:**
```bash
Обновление зависимостей: path/to/packagedef

 ✓ 1connector         2.3.1 → 2.3.3
 ✓ autumn             3.3.0 → 4.3.11
 ✓ autumn-cli         1.1.0 → 1.2.0
 
Выполните opm install для установки новых версий пакетов.
```

### Диагностика зависимостей

Команда `doctor` анализирует зависимости проекта и выявляет потенциальные проблемы.

```bash
depos doctor
```

**Пример вывода:**
```bash
Диагностика зависимостей: path/to/packagedef

Отсутствующие пакеты в манифесте:

   jason
     - path/to/src/МойКласс1.os
     - path/to/src/МойКласс2.os
   asserts (dev)
     - path/to/tests/Тесты.os

Неиспользуемые пакеты в коде

   cli
   1bdd (dev)

Найдено проблем: 4
```

## Команды

### check 

Проверяет доступные обновления для зависимостей проекта без внесения изменений в файл `packagedef`.

**Синтаксис:**
```bash
depos check [--packagedef <путь>] [-d|--deprecated] [-f|--filter <фильтр>] [-t|--target <тип>]
```

| Опция | Описание |
| --- | --- |
| --packagedef <путь> | Путь к `packagedef` или его каталогу (по умолчанию - текущая директория). |
| -d, --deprecated | Показывать только устаревшие пакеты. |
| -f, --filter <фильтр> | Фильтр пакетов по именам (через запятую или пробел), шаблону (`*`, `?`) или регулярному выражению.<br>**Примеры:**<br> `depos check -f autumn,oint`<br>`depos check -f 'autumn oint'` <br> `depos check -f autumn-*` <br> `depos check -f '/^autumn-(.*)$/'` |
| -t, --target <тип> | Тип целевой версии (по умолчанию: `latest`). <br>**Значения:** <br>`latest` - последняя доступная версия пакета.<br>`minor` - последняя минорная или патч-версия в пределах основной версии.<br>`patch` - последняя патч-версия в пределах минорной версии. |

### upgrade 

Обновляет версии зависимостей в файле `packagedef` до указанных целевых версий.

**Синтаксис:**
```bash
depos upgrade [--packagedef <путь>] [--backup] [-f|--filter <фильтр>] [-t|--target <тип>]
```

| Опция | Описание |
| --- | --- |
| --packagedef <путь> | Путь к `packagedef` или его каталогу (по умолчанию - текущая директория). |
| --backup | Создать резервную копию файла `packagedef` перед изменением. |
| -f, --filter <фильтр> | Фильтр пакетов по именам (через запятую или пробел), шаблону (`*`, `?`) или регулярному выражению.<br>**Примеры:**<br> `depos upgrade -f autumn,oint`<br>`depos upgrade -f 'autumn oint'` <br> `depos upgrade -f autumn-*` <br> `depos upgrade -f '/^autumn-(.*)$/'` |
| -t, --target <тип> | Тип целевой версии (по умолчанию: `latest`). <br>**Значения:** <br> `latest` - последняя доступная версия пакета.<br>`minor` - последняя минорная или патч-версия в пределах основной версии.<br>`patch` - последняя патч-версия в пределах минорной версии. |

### doctor

Анализирует зависимости проекта и выявляет потенциальные проблемы.

**Синтаксис:**
```bash
depos doctor [--packagedef <путь>] [--src-dirs <каталоги>] [--dev-dirs <каталоги>] [--ignore-dev] [--strict]
```

| Опция | Описание |
| --- | --- |
| --packagedef <путь> | Путь к `packagedef` или его каталогу (по умолчанию - текущая директория). |
| --src-dirs <каталоги> | Каталоги исходников для анализа (через запятую). По умолчанию: `src`. |
| --dev-dirs <каталоги> | Каталоги служебных исходников для анализа (через запятую). По умолчанию: `tests` и `tasks`. |
| --ignore-dev | Игнорировать служебные исходники при анализе. |
| --strict | Ненулевой код возврата при любых найденных проблемах. |